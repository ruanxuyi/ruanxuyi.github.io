<!doctype html>



  


<html class="theme-next muse use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  
    
      
    

    
  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Bree Serif:300,300italic,400,400italic,700,700italic|Arimo:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Algorithm,DP," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/sushi.png?v=5.0.1" />






<meta name="keywords" content="Algorithm,DP">
<meta property="og:type" content="article">
<meta property="og:title" content="Top 5 Frequently Used Algorithms: #2 Dynamic Programming">
<meta property="og:url" content="http://www.xuyiruan.com/2018/02/24/five-most-frequent-use-algorithms-2-dp/index.html">
<meta property="og:site_name" content="é˜®å…ˆç”Ÿdeå°çª">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://7xihzu.com1.z0.glb.clouddn.com/2018/02/25/dp_quartlet.png">
<meta property="og:updated_time" content="2018-02-25T18:29:51.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Top 5 Frequently Used Algorithms: #2 Dynamic Programming">
<meta name="twitter:image" content="http://7xihzu.com1.z0.glb.clouddn.com/2018/02/25/dp_quartlet.png">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: 'Author'
    }
  };
</script>

  <title> Top 5 Frequently Used Algorithms: #2 Dynamic Programming | é˜®å…ˆç”Ÿdeå°çª </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">é˜®å…ˆç”Ÿdeå°çª</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">å¤šè¯»ä¹¦ å¤šæ€è€ƒ å°‘åƒé›¶é£Ÿ å¤šç¡è§‰</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Top 5 Frequently Used Algorithms: #2 Dynamic Programming
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2018-02-24T11:29:23-05:00" content="02-24-2018">
              02-24-2018
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2018/02/24/five-most-frequent-use-algorithms-2-dp/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2018/02/24/five-most-frequent-use-algorithms-2-dp/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2018/02/24/five-most-frequent-use-algorithms-2-dp/" class="leancloud_visitors" data-flag-title="Top 5 Frequently Used Algorithms: #2 Dynamic Programming">
               &nbsp; | &nbsp;
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">visitors </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="http://7xihzu.com1.z0.glb.clouddn.com/2018/02/25/dp_quartlet.png" alt=""></p>
<a id="more"></a>
<h2 id="basic-concept"><a href="#basic-concept" class="headerlink" title="basic concept"></a>basic concept</h2><p>A complex problem can be break into multiple subproblem, hope for subproblem is easy enough so that it could be easily solved. Memeorziation is part of DP which helps to reduce unnecessary computation.  </p>
<h2 id="key-ideas"><a href="#key-ideas" class="headerlink" title="key ideas"></a>key ideas</h2><ul>
<li><strong>recursion tree</strong>: draw out for subproblem  </li>
<li><strong>memoization</strong>: cache duplicate sub-steps (result of <strong>overlap</strong> subproblems)  </li>
<li><strong>dynamic programing</strong> = recursion(divide &amp; conquer) + memoization  </li>
<li>dp æ˜¯ä¸€ç§è®¾è®¡çš„æ€æƒ³ ä¸æ˜¯ä¸€ç§ç®—æ³•</li>
</ul>
<p><a href="https://stackoverflow.com/questions/12133754/whats-the-difference-between-recursion-memoization-dynamic-programming" target="_blank" rel="noopener">https://stackoverflow.com/questions/12133754/whats-the-difference-between-recursion-memoization-dynamic-programming</a></p>
<p>DP can be implemented via two ways:  </p>
<ol>
<li><strong>recursively</strong> (recursion + memoization)  </li>
<li><strong>itratively</strong> (forloop OR nested forloops)  </li>
</ol>
<p>Iterative algorithm can also utilize DP<br>iterative approach usually faster, but harder to construct.<br>recursive approach also call â€˜lazy approachâ€™, if â€˜lazyâ€™ not too bad, we tend to stick with it since it is easy to reasoning.  </p>
<h2 id="difference-to-divide-and-conquer"><a href="#difference-to-divide-and-conquer" class="headerlink" title="difference to divide and conquer"></a>difference to divide and conquer</h2><ul>
<li>subproblems between <strong>dynmaically programming</strong> are <strong>NOT</strong> independent, solution of current subproblem usually <strong>depends</strong> on result of previous states  </li>
<li>on the other hand, subproblems in <strong>divide and conquer</strong> are usually <strong>independent</strong></li>
</ul>
<h2 id="memoization-vs-tabulation"><a href="#memoization-vs-tabulation" class="headerlink" title="memoization vs tabulation"></a>memoization vs tabulation</h2><ul>
<li>tabulation with <code>Fib</code> lets you use $O(1)$ space, but memoization with <code>Fib</code> uses $O(N)$ stack space.  </li>
<li>example for memo/tabulation: <a href="https://stackoverflow.com/questions/6164629/dynamic-programming-and-memoization-bottom-up-vs-top-down-approaches" target="_blank" rel="noopener">https://stackoverflow.com/questions/6164629/dynamic-programming-and-memoization-bottom-up-vs-top-down-approaches</a></li>
</ul>
<h2 id="top-down-vs-bottom-up"><a href="#top-down-vs-bottom-up" class="headerlink" title="top-down vs bottom up"></a>top-down vs bottom up</h2><ul>
<li>usually not distinguish much.</li>
</ul>
<h2 id="when-to-use-DP"><a href="#when-to-use-DP" class="headerlink" title="when to use DP?"></a>when to use DP?</h2><p>æ»¡è¶³ä¸‹é¢ä¸‰ä¸ªæ¡ä»¶ä¹‹ä¸€: </p>
<ul>
<li>æ±‚æœ€å¤§å€¼æœ€å°å€¼  </li>
<li>åˆ¤æ–­æ˜¯å¦å¯è¡Œ  </li>
<li>ç»Ÿè®¡æ–¹æ¡ˆä¸ªæ•°  </li>
</ul>
<h2 id="when-NOT-to-use-DP"><a href="#when-NOT-to-use-DP" class="headerlink" title="when NOT to use DP?"></a>when NOT to use DP?</h2><ul>
<li>ask for <strong>all</strong> possible paths, instead of number of paths  </li>
<li>è¾“å…¥æ•°æ®æ˜¯ä¸€ä¸ª é›†åˆ è€Œä¸æ˜¯ åºåˆ—???  </li>
<li>æš´åŠ›ç®—æ³•çš„å¤æ‚åº¦å·²ç»æ˜¯å¤šé¡¹å¼($n^2,n^3$)çº§åˆ«: åŠ¨æ€è§„åˆ’æ“…é•¿ä¸ä¼˜åŒ–æŒ‡æ•°çº§åˆ«å¤æ‚åº¦($2^n,n!$)åˆ°å¤šé¡¹å¼çº§åˆ«å¤æ‚åº¦($n^2,n^3$), ä¸æ“…é•¿ä¼˜åŒ–$n^3$åˆ°$n^2$</li>
</ul>
<h2 id="DP-quartet"><a href="#DP-quartet" class="headerlink" title="DP quartet"></a>DP quartet</h2><ol>
<li>çŠ¶æ€ <strong>State</strong>: çµæ„Ÿï¼Œåˆ›é€ åŠ›, what should the hash <code>dp[]</code> stores (<code>dp[n]</code> <strong>usually</strong> stores min/max value)</li>
<li>æ–¹ç¨‹ <strong>Function</strong>: how to calculate <code>dp[n]</code> based on <code>dp[n-1]</code>, <code>dp[n-2]</code>, .., <code>dp[2]</code>, and <code>dp[1]</code>  </li>
<li>åˆå§‹åŒ– <strong>Initialization</strong>: what should the initial values be based on the meaning of the state  </li>
<li>ç­”æ¡ˆ <strong>Answer</strong>: which value should we return as the final result  </li>
</ol>
<h2 id="DP-tips"><a href="#DP-tips" class="headerlink" title="DP tips:"></a>DP tips:</h2><ul>
<li>if given string/array have size $N$, usually we need to create a $N+1$ array, where $array[0]$ for initialization.  </li>
<li>if given 2D array with size $m$ and $n$, usually we create a new $hash[m][n]$ 2D array. Try $hahs[m+1][n+1]$ if $hash[m][n]$ not work.  </li>
</ul>
<h2 id="DP-vs-Greedy-Algorithm"><a href="#DP-vs-Greedy-Algorithm" class="headerlink" title="DP vs Greedy Algorithm"></a>DP vs Greedy Algorithm</h2><p>Sometimes, DP is not necessary the most optimized solution, greedy could be more efficient than DP  </p>
<p><a href="https://leetcode.com/problems/jump-game/description/" target="_blank" rel="noopener">https://leetcode.com/problems/jump-game/description/</a><br>Optimized Algorithm: Greedy, time complexity $O(n)$<br>Sub-optimized Algorithm: DPï¼Œtime complexity $O(n^2)$  </p>
<h2 id="DP-questions"><a href="#DP-questions" class="headerlink" title="DP questions:"></a>DP questions:</h2><ul>
<li><p>TODO: lc62: how to brute force all PATHs? </p>
</li>
<li><p>why not recursion?<br><a href="https://leetcode.com/problems/coin-change/description/" target="_blank" rel="noopener">https://leetcode.com/problems/coin-change/description/</a><br>dp could be either solved by <strong>recursive</strong> (divide and conquer + memoization) OR <strong>iterative</strong> approach (nested for-loop)  </p>
</li>
</ul>

      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Algorithm/" rel="tag">#Algorithm</a>
          
            <a href="/tags/DP/" rel="tag">#DP</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/02/24/five-most-frequent-use-alogrithms-1-divide-and-conquer/" rel="next" title="Top 5 Frequently Used Algorithms: #1 Divide and Conquer">
                <i class="fa fa-chevron-left"></i> Top 5 Frequently Used Algorithms: #1 Divide and Conquer
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/03/11/permutation-and-combination/" rel="prev" title="Permutation and Combination of a Given String">
                Permutation and Combination of a Given String <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/author.jpg"
               alt="ğŸ£ä¹‹ç¥" />
          <p class="site-author-name" itemprop="name">ğŸ£ä¹‹ç¥</p>
          <p class="site-description motion-element" itemprop="description">é˜®å…ˆç”Ÿâ€™s blog</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">99</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">80</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/ruanxuyi" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.instagram.com/xuyiruan/" target="_blank" title="Instagram">
                  
                    <i class="fa fa-fw fa-instagram"></i>
                  
                  Instagram
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.linkedin.com/in/xuyi-ruan-a728a889" target="_blank" title="Linkedin">
                  
                    <i class="fa fa-fw fa-linkedin"></i>
                  
                  Linkedin
                </a>
              </span>
            
          
        </div>

        
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-block">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              Links
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://mszhuchinese.com" title="MsZhuChinese" target="_blank">MsZhuChinese</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.winniebabe.com" title="WinnieBabe" target="_blank">WinnieBabe</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://suncuss.me" title="BossSun" target="_blank">BossSun</a>
                </li>
              
            </ul>
          </div>
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#basic-concept"><span class="nav-number">1.</span> <span class="nav-text">basic concept</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#key-ideas"><span class="nav-number">2.</span> <span class="nav-text">key ideas</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#difference-to-divide-and-conquer"><span class="nav-number">3.</span> <span class="nav-text">difference to divide and conquer</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#memoization-vs-tabulation"><span class="nav-number">4.</span> <span class="nav-text">memoization vs tabulation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#top-down-vs-bottom-up"><span class="nav-number">5.</span> <span class="nav-text">top-down vs bottom up</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#when-to-use-DP"><span class="nav-number">6.</span> <span class="nav-text">when to use DP?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#when-NOT-to-use-DP"><span class="nav-number">7.</span> <span class="nav-text">when NOT to use DP?</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DP-quartet"><span class="nav-number">8.</span> <span class="nav-text">DP quartet</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DP-tips"><span class="nav-number">9.</span> <span class="nav-text">DP tips:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DP-vs-Greedy-Algorithm"><span class="nav-number">10.</span> <span class="nav-text">DP vs Greedy Algorithm</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#DP-questions"><span class="nav-number">11.</span> <span class="nav-text">DP questions:</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ğŸ£ä¹‹ç¥</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="http://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'xruan';
      var disqus_identifier = '2018/02/24/five-most-frequent-use-algorithms-2-dp/';
      var disqus_title = "Top 5 Frequently Used Algorithms: #2 Dynamic Programming";
      var disqus_url = 'http://www.xuyiruan.com/2018/02/24/five-most-frequent-use-algorithms-2-dp/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        run_disqus_script('embed.js');
      
    </script>
  




  
  
  
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
  </script>

  <script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for (i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';
      }
    });
  </script>
  <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("oKoPG1XTXkC7T1oasGQwau2g-gzGzoHsz", "JFJCQtIsUKhrX6S7Gvgqdqgk");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

</body>
</html>
